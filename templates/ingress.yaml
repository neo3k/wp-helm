apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ .Values.appName }}-ingress
  namespace: default
  annotations:
    kubernetes.io/ingress.class: traefik
    cert-manager.io/cluster-issuer: letsencrypt
spec:
{{- $domains := .Values.domains | toYaml | fromYaml }}
{{- if $domains }}
  rules:
  {{- range $domains }}
    - host: "{{ . }}"
      http:
        paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: {{ $.Values.appName }}-service
              port:
                number: 80
  {{- end }}
  tls:
    - hosts:
    {{- range $domains }}
      - "{{ . }}"
    {{- end }}
      secretName: {{ .Values.tlsSecretName | default (printf "%s-tls" .Values.appName) }}
{{- else }}
  defaultBackend:
    service:
      name: {{ .Values.appName }}-service
      port:
        number: 80
{{- end }}
